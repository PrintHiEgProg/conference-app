{"ast":null,"code":"import React,{useEffect,useRef,useState}from\"react\";import{io}from\"socket.io-client\";import{useParams}from\"react-router-dom\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const socket=io(\"http://localhost:3001\");const AudioStream=()=>{const{roomID}=useParams();const audioRef=useRef(null);const[typeUser,setTypeUser]=useState(false);// false - слушатель, true - передатчик\nuseEffect(()=>{socket.emit(\"joinVoiceRoom\",{roomID,typeUser});socket.on(\"audio\",data=>{const audioBlob=new Blob([data],{type:\"audio/webm\"});const audioUrl=URL.createObjectURL(audioBlob);audioRef.current.src=audioUrl;audioRef.current.play();});return()=>{socket.off(\"audio\");};},[roomID,typeUser]);const startRecording=async()=>{const stream=await navigator.mediaDevices.getUserMedia({audio:true});const mediaRecorder=new MediaRecorder(stream);mediaRecorder.ondataavailable=event=>{if(event.data.size>0){socket.emit(\"audio\",event.data);}};mediaRecorder.start(100);// отправляем данные каждые 100 мс\n// Остановить запись после 10 секунд\nsetTimeout(()=>{mediaRecorder.stop();},10000);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Room ID: \",roomID]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"true\",checked:typeUser===true,onChange:()=>setTypeUser(true)}),\"\\u041F\\u0435\\u0440\\u0435\\u0434\\u0430\\u0442\\u0447\\u0438\\u043A\"]}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"false\",checked:typeUser===false,onChange:()=>setTypeUser(false)}),\"\\u0421\\u043B\\u0443\\u0448\\u0430\\u0442\\u0435\\u043B\\u044C\"]})]}),typeUser&&/*#__PURE__*/_jsx(\"button\",{onClick:startRecording,children:\"Start Recording\"}),/*#__PURE__*/_jsx(\"audio\",{ref:audioRef,controls:true})]});};export default AudioStream;","map":{"version":3,"names":["React","useEffect","useRef","useState","io","useParams","jsxs","_jsxs","jsx","_jsx","socket","AudioStream","roomID","audioRef","typeUser","setTypeUser","emit","on","data","audioBlob","Blob","type","audioUrl","URL","createObjectURL","current","src","play","off","startRecording","stream","navigator","mediaDevices","getUserMedia","audio","mediaRecorder","MediaRecorder","ondataavailable","event","size","start","setTimeout","stop","children","value","checked","onChange","onClick","ref","controls"],"sources":["/Users/egorkobzev/conference-app/src/AudioStream.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { useParams } from \"react-router-dom\";\n\nconst socket = io(\"http://localhost:3001\");\n\nconst AudioStream = () => {\n  const { roomID } = useParams();\n  const audioRef = useRef(null);\n  const [typeUser, setTypeUser] = useState(false); // false - слушатель, true - передатчик\n\n  useEffect(() => {\n    socket.emit(\"joinVoiceRoom\", { roomID, typeUser });\n\n    socket.on(\"audio\", (data) => {\n      const audioBlob = new Blob([data], { type: \"audio/webm\" });\n      const audioUrl = URL.createObjectURL(audioBlob);\n      audioRef.current.src = audioUrl;\n      audioRef.current.play();\n    });\n\n    return () => {\n      socket.off(\"audio\");\n    };\n  }, [roomID, typeUser]);\n\n  const startRecording = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    const mediaRecorder = new MediaRecorder(stream);\n\n    mediaRecorder.ondataavailable = (event) => {\n      if (event.data.size > 0) {\n        socket.emit(\"audio\", event.data);\n      }\n    };\n\n    mediaRecorder.start(100); // отправляем данные каждые 100 мс\n\n    // Остановить запись после 10 секунд\n    setTimeout(() => {\n      mediaRecorder.stop();\n    }, 10000);\n  };\n\n  return (\n    <div>\n      <h2>Room ID: {roomID}</h2>\n      <div>\n        <label>\n          <input\n            type=\"radio\"\n            value=\"true\"\n            checked={typeUser === true}\n            onChange={() => setTypeUser(true)}\n          />\n          Передатчик\n        </label>\n        <label>\n          <input\n            type=\"radio\"\n            value=\"false\"\n            checked={typeUser === false}\n            onChange={() => setTypeUser(false)}\n          />\n          Слушатель\n        </label>\n      </div>\n      {typeUser && <button onClick={startRecording}>Start Recording</button>}\n      <audio ref={audioRef} controls></audio>\n    </div>\n  );\n};\n\nexport default AudioStream;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}